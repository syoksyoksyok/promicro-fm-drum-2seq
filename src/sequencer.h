#ifndef SEQUENCER_H
#define SEQUENCER_H

#include <stdint.h>

// =============================================================================
// シーケンサ設定
// =============================================================================

#define MAX_STEPS 16
#define NUM_TRACKS 2

// =============================================================================
// ステップデータ構造体
// =============================================================================

struct Step {
  uint8_t flags;  // bit0: gate, bit1: accent
};

// フラグのビットマスク
#define STEP_FLAG_GATE    0x01
#define STEP_FLAG_ACCENT  0x02

// =============================================================================
// パターン構造体
// =============================================================================

struct Pattern {
  uint8_t length;        // ステップ数（デフォルト16）
  Step steps[MAX_STEPS]; // ステップデータ
};

// =============================================================================
// グローバル変数（extern宣言）
// =============================================================================

extern volatile bool isPlaying;  // 再生中フラグ

// =============================================================================
// 関数宣言
// =============================================================================

// シーケンサの初期化
void sequencerInit();

// シーケンサの更新（メインループから定期的に呼ぶ）
void sequencerUpdate();

// BPMの設定
void setBPM(uint16_t bpm);

// パターンのランダム生成
void randomizePattern(uint8_t track);

// 全パターンとパラメータのランダム化
void randomizeAll();

// デモパターンのロード
void loadDemoPattern();

// 再生/停止のトグル
void togglePlayback();

#endif // SEQUENCER_H
